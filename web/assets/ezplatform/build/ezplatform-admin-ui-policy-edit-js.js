(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["ezplatform-admin-ui-policy-edit-js"],{

/***/ "./vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js":
/*!**************************************************************************************************************!*\
  !*** ./vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js ***!
  \**************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n(function (global, doc, eZ, React, ReactDOM, Translator) {\n  var _this = this;\n\n  var SELECTOR_LOCATION_LIMITATION_BTN = '.ez-pick-location-limitation-button';\n  var SELECTOR_EZ_TAG = '.ez-tag';\n  var IDS_SEPARATOR = ',';\n  var token = doc.querySelector('meta[name=\"CSRF-Token\"]').content;\n  var siteaccess = doc.querySelector('meta[name=\"SiteAccess\"]').content;\n  var udwContainer = doc.getElementById('react-udw');\n  var limitationBtns = doc.querySelectorAll(SELECTOR_LOCATION_LIMITATION_BTN);\n\n  var findLocationsByIdList = function findLocationsByIdList(pathArraysWithoutRoot, callback) {\n    var bulkOperations = getBulkOperations(pathArraysWithoutRoot);\n    var request = new Request('/api/ezp/v2/bulk', {\n      method: 'POST',\n      headers: {\n        Accept: 'application/vnd.ez.api.BulkOperationResponse+json',\n        'Content-Type': 'application/vnd.ez.api.BulkOperation+json',\n        'X-Siteaccess': siteaccess,\n        'X-CSRF-Token': token\n      },\n      body: JSON.stringify({\n        bulkOperations: {\n          operations: bulkOperations\n        }\n      }),\n      mode: 'same-origin',\n      credentials: 'same-origin'\n    });\n    var errorMessage = Translator.trans(\n    /*@Desc(\"Failed to fetch content names\")*/\n    'limitation.pick.error', {}, 'universal_discovery_widget');\n    fetch(request).then(eZ.helpers.request.getJsonFromResponse).then(callback).catch(function () {\n      return eZ.helpers.notification.showErrorNotification(errorMessage);\n    });\n  };\n\n  var getBulkOperations = function getBulkOperations(pathArraysWithoutRoot) {\n    return pathArraysWithoutRoot.reduce(function (operations, pathArray) {\n      var locationId = pathArray[pathArray.length - 1];\n      operations[locationId] = {\n        uri: '/api/ezp/v2/views',\n        method: 'POST',\n        headers: {\n          Accept: 'application/vnd.ez.api.View+json; version=1.1',\n          'Content-Type': 'application/vnd.ez.api.ViewInput+json; version=1.1',\n          'X-Requested-With': 'XMLHttpRequest'\n        },\n        content: JSON.stringify({\n          ViewInput: {\n            identifier: \"udw-locations-by-path-string-\".concat(pathArray.join('-')),\n            public: false,\n            LocationQuery: {\n              Criteria: {},\n              FacetBuilders: {},\n              SortClauses: {\n                SectionIdentifier: 'ascending'\n              },\n              Filter: {\n                LocationIdCriterion: pathArray.join(IDS_SEPARATOR)\n              },\n              limit: 50,\n              offset: 0\n            }\n          }\n        })\n      };\n      return operations;\n    }, {});\n  };\n\n  var removeRootLocation = function removeRootLocation(pathArray) {\n    return pathArray.slice(1);\n  };\n\n  var pathStringToPathArray = function pathStringToPathArray(pathString) {\n    return pathString.split('/').filter(function (el) {\n      return el;\n    });\n  };\n\n  var buildContentBreadcrumbs = function buildContentBreadcrumbs(viewData) {\n    var searchHitList = viewData.View.Result.searchHits.searchHit;\n    return searchHitList.map(function (searchHit) {\n      return searchHit.value.Location.ContentInfo.Content.Name;\n    }).join(' / ');\n  };\n\n  var addLocationsToInput = function addLocationsToInput(limitationBtn, newlySelectedItems) {\n    var input = doc.querySelector(limitationBtn.dataset.locationInputSelector);\n    var newlySelectedLocationsIds = newlySelectedItems.map(function (item) {\n      return item.id;\n    }).join(IDS_SEPARATOR);\n    input.value = input.value ? \"\".concat(input.value).concat(IDS_SEPARATOR).concat(newlySelectedLocationsIds) : newlySelectedLocationsIds;\n  };\n\n  var removeLocationFromInput = function removeLocationFromInput(locationInputSelector, removedLocationId) {\n    var input = doc.querySelector(locationInputSelector);\n    var locationsIdsWithoutRemoved = input.value.split(IDS_SEPARATOR).filter(function (locationId) {\n      return locationId !== removedLocationId;\n    });\n    input.value = locationsIdsWithoutRemoved.join(IDS_SEPARATOR);\n  };\n\n  var addLocationsTags = function addLocationsTags(limitationBtn, newlySelectedItems) {\n    var tagsList = doc.querySelector(limitationBtn.dataset.selectedLocationListSelector);\n    var tagTemplate = limitationBtn.dataset.valueTemplate;\n    var fragment = doc.createDocumentFragment();\n    newlySelectedItems.forEach(function (location) {\n      var locationId = location.id;\n      var container = doc.createElement('ul');\n      var renderedItem = tagTemplate.replace('{{ location_id }}', locationId);\n      container.insertAdjacentHTML('beforeend', renderedItem);\n      var listItemNode = container.querySelector('li');\n      var tagNode = listItemNode.querySelector(SELECTOR_EZ_TAG);\n      attachTagEventHandlers(limitationBtn, tagNode);\n      fragment.append(listItemNode);\n    });\n    tagsList.append(fragment);\n    setTagsBreadcrumbs(tagsList, newlySelectedItems);\n  };\n\n  var setTagsBreadcrumbs = function setTagsBreadcrumbs(tagsList, newlySelectedItems) {\n    var pathArraysWithoutRoot = newlySelectedItems.map(getLocationPathArray);\n    findLocationsByIdList(pathArraysWithoutRoot, function (response) {\n      var operations = response.BulkOperationResponse.operations;\n      Object.entries(operations).forEach(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            locationId = _ref2[0],\n            content = _ref2[1].content;\n\n        var viewData = JSON.parse(content);\n        var tag = tagsList.querySelector(\"[data-location-id=\\\"\".concat(locationId, \"\\\"]\"));\n        var tagContent = tag.querySelector('.ez-tag__content');\n        var tagSpinner = tag.querySelector('.ez-tag__spinner');\n        tagContent.innerText = buildContentBreadcrumbs(viewData);\n        tagSpinner.hidden = true;\n        tagContent.hidden = false;\n      });\n    });\n  };\n\n  var getLocationPathArray = function getLocationPathArray(_ref3) {\n    var pathString = _ref3.pathString;\n    var pathArray = pathStringToPathArray(pathString);\n    var pathArrayWithoutRoot = removeRootLocation(pathArray);\n    return pathArrayWithoutRoot;\n  };\n\n  var handleTagRemove = function handleTagRemove(limitationBtn, tag) {\n    var removedLocationId = tag.dataset.locationId;\n    var locationInputSelector = limitationBtn.dataset.locationInputSelector;\n    removeLocationFromInput(locationInputSelector, removedLocationId);\n    tag.remove();\n  };\n\n  var attachTagEventHandlers = function attachTagEventHandlers(limitationBtn, tag) {\n    var removeTagBtn = tag.querySelector('.ez-tag__remove-btn');\n    removeTagBtn.addEventListener('click', function () {\n      return handleTagRemove(limitationBtn, tag);\n    }, false);\n  };\n\n  var closeUDW = function closeUDW() {\n    return ReactDOM.unmountComponentAtNode(udwContainer);\n  };\n\n  var handleUdwConfirm = function handleUdwConfirm(limitationBtn, newlySelectedItems) {\n    if (newlySelectedItems.length) {\n      addLocationsToInput(limitationBtn, newlySelectedItems);\n      addLocationsTags(limitationBtn, newlySelectedItems);\n    }\n\n    closeUDW();\n  };\n\n  var openUDW = function openUDW(event) {\n    event.preventDefault();\n    var limitationBtn = event.currentTarget;\n    var input = doc.querySelector(limitationBtn.dataset.locationInputSelector);\n    var selectedLocationsIds = input.value.split(IDS_SEPARATOR).map(function (idString) {\n      return parseInt(idString, 10);\n    });\n    var config = JSON.parse(event.currentTarget.dataset.udwConfig);\n    var title = Translator.trans(\n    /*@Desc(\"Choose locations\")*/\n    'subtree_limitation.title', {}, 'universal_discovery_widget');\n    ReactDOM.render(React.createElement(eZ.modules.UniversalDiscovery, Object.assign({\n      onConfirm: handleUdwConfirm.bind(_this, event.target),\n      onCancel: closeUDW,\n      title: title,\n      startingLocationId: eZ.adminUiConfig.universalDiscoveryWidget.startingLocationId,\n      multiple: true,\n      restInfo: {\n        token: token,\n        siteaccess: siteaccess\n      },\n      canSelectContent: function canSelectContent(_ref4, callback) {\n        var item = _ref4.item;\n        var itemId = parseInt(item.id, 10);\n        callback(!selectedLocationsIds.includes(itemId));\n      }\n    }, config)), udwContainer);\n  };\n\n  limitationBtns.forEach(function (limitationBtn) {\n    var tagsList = doc.querySelector(limitationBtn.dataset.selectedLocationListSelector);\n    var tags = tagsList.querySelectorAll(SELECTOR_EZ_TAG);\n    tags.forEach(attachTagEventHandlers.bind(null, limitationBtn));\n    limitationBtn.addEventListener('click', openUDW, false);\n  });\n})(window, document, window.eZ, window.React, window.ReactDOM, window.Translator);\n\n//# sourceURL=webpack:///./vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js?");

/***/ }),

/***/ 6:
/*!********************************************************************************************************************!*\
  !*** multi ./vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js ***!
  \********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("module.exports = __webpack_require__(/*! /home/dev/server/pb-demo.v2/vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js */\"./vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js\");\n\n\n//# sourceURL=webpack:///multi_./vendor/ezsystems/ezplatform-admin-ui/src/bundle/Resources/public/js/scripts/admin.limitation.pick.js?");

/***/ })

},[[6,"runtime"]]]);